<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeprekGo | Dashboard</title>
  <style>
    :root {
      --bg: #f7f8fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --accent: #111827;
      --accent2: #f59e0b;
      --border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      padding: 16px;
    }
    .shell {
      max-width: 1080px;
      margin: 0 auto;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 18px;
    }
    .brand { font-size: 22px; font-weight: 800; letter-spacing: -0.02em; }
    .pill {
      background: #111827;
      color: #fff;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .grid {
      display: grid;
      gap: 14px;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
    }
    .card {
      background: var(--card);
      border: 1px solid rgba(17, 24, 39, 0.04);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    }
    h2 {
      margin: 0 0 10px;
      font-size: 17px;
      letter-spacing: -0.01em;
    }
    .muted { color: var(--muted); font-size: 14px; }
    button {
      border: none;
      border-radius: 12px;
      padding: 10px 12px;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.15s ease, background 0.2s ease;
    }
    button:hover { background: #0b1224; box-shadow: 0 10px 18px rgba(17,24,39,0.15); }
    button:active { transform: translateY(1px); }
    .ghost {
      background: #f3f4f6;
      color: var(--text);
      box-shadow: none;
    }
    .ghost:hover { background: #e5e7eb; box-shadow: none; }
    .vendor-card { display: flex; flex-direction: column; gap: 6px; }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f3f4f6;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--text);
    }
    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed var(--border);
      gap: 12px;
    }
    .menu-item:last-child { border-bottom: none; }
    .menu-title { font-weight: 700; }
    .small { font-size: 13px; color: var(--muted); }
    .section-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 4px 0 10px;
      gap: 8px;
    }
    .status-steps {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .status-pill {
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 13px;
      border: 1px solid var(--border);
      background: #f9fafb;
    }
    .status-pill.active {
      background: #ecfeff;
      border-color: #06b6d4;
      color: #0f172a;
      font-weight: 700;
    }
    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .total {
      font-size: 18px;
      font-weight: 800;
    }
    .badge { background: #fef3c7; color: #92400e; border-radius: 8px; padding: 6px 8px; font-weight: 700; font-size: 12px; }
    .list { display: flex; flex-direction: column; gap: 10px; }
    #cartCard { position: sticky; top: 12px; }
    #mobileCartBar {
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: 12px;
      background: #111827;
      color: #fff;
      border-radius: 14px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      box-shadow: 0 16px 30px rgba(0,0,0,0.2);
    }
    #mobileCartBar button {
      background: #f59e0b;
      color: #111827;
      margin: 0;
    }
    @media (max-width: 720px) {
      header { flex-direction: column; align-items: flex-start; }
      #cartCard { position: static; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div>
        <div class="brand">GeprekGo</div>
        <div class="muted">Halo, <span id="userName">Rani</span> — Kost Mawar, Blok B3</div>
      </div>
      <div class="pill">Saldo: <strong>Rp120.000</strong></div>
    </header>

    <div class="grid">
      <div class="cards">
        <div class="card">
          <div class="section-title">
            <h2>Vendor Ayam Geprek</h2>
            <span class="muted" id="vendorCount"></span>
          </div>
          <div class="list" id="vendorList"></div>
        </div>

        <div class="card" id="menuCard" style="display:none;">
          <div class="section-title">
            <h2 id="menuVendorTitle">Menu</h2>
            <button class="ghost" onclick="clearSelection()">Tutup</button>
          </div>
          <div id="menuList"></div>
        </div>

        <div class="card" id="cartCard">
          <div class="section-title">
            <h2>Keranjang</h2>
            <button class="ghost" onclick="resetCart()">Kosongkan</button>
          </div>
          <div id="cartList" class="list muted">Belum ada item.</div>
          <div style="margin-top:12px;">
            <div class="row"><span class="small">Subtotal</span><strong id="subtotal">Rp0</strong></div>
            <div class="row"><span class="small">Ongkir</span><strong id="delivery">Rp0</strong></div>
            <div class="row total">Total <span id="total">Rp0</span></div>
          </div>
          <button style="margin-top:12px; width:100%;" onclick="placeOrder()">Buat Pesanan Demo</button>
        </div>

        <div class="card">
          <div class="section-title">
            <h2>Status Pesanan</h2>
            <button class="ghost" onclick="advanceStatus()">Lanjutkan Status</button>
          </div>
          <div class="status-steps" id="statusSteps"></div>
          <div class="muted" id="statusNote" style="margin-top:10px;">Belum ada pesanan.</div>
        </div>
      </div>
    </div>
    <div id="mobileCartBar" style="display:none;">
      <div id="mobileCartText"></div>
      <button onclick="placeOrder()">Pesan</button>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const displayName = params.get("user") || "Rani";
    document.getElementById("userName").textContent = displayName;

    const CART_KEY = "geprekgo_cart";
    const ORDER_KEY = "geprekgo_order";

    const MENU_KEY = "geprekgo_vendor_menu";
    const vendors = [
      {
        id: "rudi",
        name: "Ayam Geprek Bung Rudi",
        distanceKm: 1.2,
        deliveryFee: 8000,
        rating: 4.7,
        prepTime: "12-15 mnt",
        menu: [
          { name: "Original", price: 18000, spice: "Level 2" },
          { name: "Keju", price: 22000, spice: "Level 2" },
          { name: "Level 3", price: 20000, spice: "Level 3" },
          { name: "Nasi + Es Teh", price: 24000, spice: "Level 1" }
        ]
      },
      {
        id: "mampus",
        name: "Geprek Pedas Mampus",
        distanceKm: 2.5,
        deliveryFee: 10000,
        rating: 4.5,
        prepTime: "15-18 mnt",
        menu: [
          { name: "Sambal Ijo", price: 19000, spice: "Level 2" },
          { name: "Matah", price: 20000, spice: "Level 3" },
          { name: "Mozzarella", price: 25000, spice: "Level 2" }
        ]
      },
      {
        id: "juara",
        name: "Geprek Juara",
        distanceKm: 0.8,
        deliveryFee: 7000,
        rating: 4.8,
        prepTime: "10-12 mnt",
        menu: [
          { name: "Paket Hemat", price: 17000, spice: "Level 2" },
          { name: "Paket Juara", price: 23000, spice: "Level 3" },
          { name: "Kulit Crispy", price: 12000, spice: "Gurih" }
        ]
      }
    ];

    let selectedVendor = null;
    let cart = [];
    const statuses = ["Dibuat", "Vendor menyiapkan", "Di-pickup", "Diantar", "Tiba", "Selesai"];
    let statusIndex = -1;
    let currentOrder = null;

    const rupiah = n => "Rp" + n.toLocaleString("id-ID");

    (function hydrateVendorMenu() {
      const saved = localStorage.getItem(MENU_KEY);
      if (!saved) return;
      try {
        const parsed = JSON.parse(saved);
        if (Array.isArray(parsed)) {
          const rudi = vendors.find(v => v.id === "rudi");
          if (rudi) rudi.menu = parsed;
        }
      } catch (_) {
        // ignore bad storage
      }
    })();

    function renderVendors() {
      const list = document.getElementById("vendorList");
      document.getElementById("vendorCount").textContent = vendors.length + " vendor";
      list.innerHTML = "";
      vendors.forEach(v => {
        const el = document.createElement("div");
        el.className = "card vendor-card";
        el.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
            <div>
              <div style="font-weight:800;">${v.name}</div>
              <div class="muted">${v.distanceKm} km · ${v.prepTime}</div>
            </div>
            <span class="badge">★ ${v.rating}</span>
          </div>
          <div class="row">
            <span class="tag">Ongkir ${rupiah(v.deliveryFee)}</span>
            <span class="tag">${v.menu.length} menu</span>
          </div>
          <div class="row" style="justify-content:space-between;">
            <div class="small">Cocok untuk makan siang cepat.</div>
            <button onclick="openMenu('${v.id}')">Lihat menu</button>
          </div>
        `;
        list.appendChild(el);
      });
    }

    function openMenu(id) {
      selectedVendor = vendors.find(v => v.id === id);
      document.getElementById("menuCard").style.display = "block";
      document.getElementById("menuVendorTitle").textContent = selectedVendor.name;
      const list = document.getElementById("menuList");
      list.innerHTML = "";
      selectedVendor.menu.forEach(item => {
        const row = document.createElement("div");
        row.className = "menu-item";
        row.innerHTML = `
          <div>
            <div class="menu-title">${item.name}</div>
            <div class="small">${item.spice}</div>
          </div>
          <div class="row" style="gap:8px;">
            <strong>${rupiah(item.price)}</strong>
            <button onclick='addToCart(${JSON.stringify(item)})'>+ Keranjang</button>
          </div>
        `;
        list.appendChild(row);
      });
    }

    function clearSelection() {
      selectedVendor = null;
      document.getElementById("menuCard").style.display = "none";
    }

    function addToCart(item) {
      if (!selectedVendor) return;
      cart.push({ ...item, vendorId: selectedVendor.id, vendorName: selectedVendor.name, deliveryFee: selectedVendor.deliveryFee });
      renderCart();
      saveCart();
    }

    function resetCart() {
      cart = [];
      renderCart();
      saveCart();
    }

    function renderCart() {
      const list = document.getElementById("cartList");
      if (!cart.length) {
        list.className = "list muted";
        list.textContent = "Belum ada item.";
        updateTotals();
        return;
      }
      list.className = "list";
      list.innerHTML = "";
      cart.forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "menu-item";
        row.innerHTML = `
          <div>
            <div class="menu-title">${item.name}</div>
            <div class="small">${item.vendorName}</div>
          </div>
          <div class="row" style="gap:8px;">
            <strong>${rupiah(item.price)}</strong>
            <button class="ghost" onclick="removeFromCart(${idx})">Hapus</button>
          </div>
        `;
        list.appendChild(row);
      });
      updateTotals();
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      renderCart();
      saveCart();
    }

    function updateTotals() {
      const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
      const deliveryFee = cart.length ? cart[0].deliveryFee : 0;
      document.getElementById("subtotal").textContent = rupiah(subtotal);
      document.getElementById("delivery").textContent = rupiah(deliveryFee);
      document.getElementById("total").textContent = rupiah(subtotal + deliveryFee);
      const bar = document.getElementById("mobileCartBar");
      const text = document.getElementById("mobileCartText");
      if (cart.length) {
        bar.style.display = "flex";
        text.textContent = cart.length + " item · " + rupiah(subtotal + deliveryFee);
      } else {
        bar.style.display = "none";
      }
    }

    function placeOrder() {
      if (!cart.length) {
        alert("Tambahkan menu dulu.");
        return;
      }
      currentOrder = {
        id: "ORD-" + Math.floor(Math.random() * 9000 + 1000),
        vendor: cart[0].vendorName,
        items: [...cart],
        total: cart.reduce((s, i) => s + i.price, 0) + cart[0].deliveryFee,
        status: statuses[0]
      };
      statusIndex = 0;
      document.getElementById("statusNote").textContent = "Pesanan " + currentOrder.id + " di " + currentOrder.vendor;
      renderStatus();
      persistOrder();
    }

    function advanceStatus() {
      if (statusIndex < 0) {
        alert("Belum ada pesanan.");
        return;
      }
      if (statusIndex < statuses.length - 1) {
        statusIndex += 1;
        currentOrder.status = statuses[statusIndex];
        renderStatus();
        persistOrder();
      } else {
        alert("Pesanan sudah selesai.");
      }
    }

    function renderStatus() {
      const wrap = document.getElementById("statusSteps");
      wrap.innerHTML = "";
      statuses.forEach((st, idx) => {
        const pill = document.createElement("div");
        pill.className = "status-pill" + (idx === statusIndex ? " active" : "");
        pill.textContent = st;
        wrap.appendChild(pill);
      });
      if (currentOrder) {
        document.getElementById("statusNote").textContent = currentOrder.id + " · " + currentOrder.vendor + " · " + statuses[statusIndex];
      }
    }

    function saveCart() {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function loadCart() {
      const saved = localStorage.getItem(CART_KEY);
      if (saved) {
        try {
          cart = JSON.parse(saved);
        } catch (_) {
          cart = [];
        }
      }
    }

    function persistOrder() {
      if (currentOrder) {
        localStorage.setItem(ORDER_KEY, JSON.stringify({ currentOrder, statusIndex }));
      } else {
        localStorage.removeItem(ORDER_KEY);
      }
    }

    function loadOrder() {
      const saved = localStorage.getItem(ORDER_KEY);
      if (!saved) return;
      try {
        const parsed = JSON.parse(saved);
        currentOrder = parsed.currentOrder;
        statusIndex = parsed.statusIndex ?? -1;
      } catch (_) {
        currentOrder = null;
        statusIndex = -1;
      }
    }

    loadCart();
    loadOrder();
    renderVendors();
    renderCart();
    renderStatus();
  </script>
</body>
</html>
